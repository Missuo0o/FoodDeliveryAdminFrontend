{"remainingRequest":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/babel-loader/lib/index.js!/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/ts-loader/index.js??ref--14-2!/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huoxiyi/IdeaProjects/MissuoFrontend/src/views/dish/addDishtype.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/src/views/dish/addDishtype.vue","mtime":1706140018193},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nrequire(\"core-js/modules/es6.number.constructor\");\n\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/defineProperty\"));\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/asyncToGenerator\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/toConsumableArray\"));\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/es6.array.find-index\");\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/inherits\"));\n\nvar _tslib = require(\"tslib\");\n\nvar _vuePropertyDecorator = require(\"vue-property-decorator\");\n\nvar _index = _interopRequireDefault(require(\"@/components/HeadLable/index.vue\"));\n\nvar _SelectInput = _interopRequireDefault(require(\"./components/SelectInput.vue\"));\n\nvar _index2 = _interopRequireDefault(require(\"@/components/ImgUpload/index.vue\"));\n\nvar _dish = require(\"@/api/dish\");\n\nvar _cookies = require(\"@/utils/cookies\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar default_1 =\n/*#__PURE__*/\nfunction (_Vue) {\n  (0, _inherits2.default)(default_1, _Vue);\n\n  function default_1() {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, default_1);\n    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(default_1).apply(this, arguments));\n    _this.restKey = 0;\n    _this.textarea = '';\n    _this.value = '';\n    _this.imageUrl = '';\n    _this.actionType = '';\n    _this.dishList = [];\n    _this.dishFlavorsData = []; //原始口味数据\n\n    _this.dishFlavors = []; //待上传口味的数据\n\n    _this.leftDishFlavors = []; //下拉框剩余可选择的口味数据\n\n    _this.vueRest = '1';\n    _this.index = 0;\n    _this.inputStyle = {\n      flex: 1\n    };\n    _this.headers = {\n      token: (0, _cookies.getToken)()\n    };\n    _this.ruleForm = {\n      name: '',\n      id: '',\n      price: '',\n      code: '',\n      image: '',\n      description: '',\n      dishFlavors: [],\n      status: true,\n      categoryId: ''\n    };\n    return _this;\n  }\n\n  (0, _createClass2.default)(default_1, [{\n    key: \"created\",\n    value: function created() {\n      this.getDishList(); // 口味临时数据\n\n      this.getFlavorListHand();\n      this.actionType = this.$route.query.id ? 'edit' : 'add';\n\n      if (this.$route.query.id) {\n        this.init();\n      }\n    }\n  }, {\n    key: \"mounted\",\n    value: function mounted() {}\n  }, {\n    key: \"changeDishFlavors\",\n    value: function changeDishFlavors() {\n      this.getLeftDishFlavors();\n    } //过滤已选择的口味下拉框无法再次选择\n\n  }, {\n    key: \"getLeftDishFlavors\",\n    value: function getLeftDishFlavors() {\n      var _this2 = this;\n\n      var arr = [];\n      this.dishFlavorsData.map(function (item) {\n        if (_this2.dishFlavors.findIndex(function (item1) {\n          return item.name === item1.name;\n        }) === -1) {\n          arr.push(item);\n        }\n      });\n      this.leftDishFlavors = arr;\n    }\n  }, {\n    key: \"selectHandle\",\n    value: function selectHandle(val, key, ind) {\n      var arrDate = (0, _toConsumableArray2.default)(this.dishFlavors);\n      var index = this.dishFlavorsData.findIndex(function (item) {\n        return item.name === val;\n      });\n      arrDate[key] = JSON.parse(JSON.stringify(this.dishFlavorsData[index]));\n      this.dishFlavors = arrDate;\n    }\n  }, {\n    key: \"init\",\n    value: function () {\n      var _init = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this3 = this;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                (0, _dish.queryDishById)(this.$route.query.id).then(function (res) {\n                  if (res && res.data && res.data.code === 200) {\n                    _this3.ruleForm = _objectSpread({}, res.data.data);\n                    _this3.ruleForm.price = String(res.data.data.price);\n                    _this3.ruleForm.status = res.data.data.status == '1';\n                    _this3.dishFlavors = res.data.data.flavors && res.data.data.flavors.map(function (obj) {\n                      return _objectSpread({}, obj, {\n                        value: JSON.parse(obj.value)\n                      });\n                    });\n                    var arr = [];\n\n                    _this3.getLeftDishFlavors();\n\n                    _this3.imageUrl = res.data.data.image;\n                  } else {\n                    _this3.$message.error(res.data.msg);\n                  }\n                });\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function init() {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }() // 按钮 - 添加口味\n\n  }, {\n    key: \"addFlavore\",\n    value: function addFlavore() {\n      this.dishFlavors.push({\n        name: '',\n        value: []\n      }); // JSON.parse(JSON.stringify(this.dishFlavorsData))\n    } // 按钮 - 删除口味\n\n  }, {\n    key: \"delFlavor\",\n    value: function delFlavor(name) {\n      var ind = this.dishFlavors.findIndex(function (item) {\n        return item.name === name;\n      });\n      this.dishFlavors.splice(ind, 1);\n    } // 按钮 - 删除口味标签\n\n  }, {\n    key: \"delFlavorLabel\",\n    value: function delFlavorLabel(index, ind) {\n      this.dishFlavors[index].value.splice(ind, 1);\n    } //口味位置记录\n\n  }, {\n    key: \"flavorPosition\",\n    value: function flavorPosition(index) {\n      this.index = index;\n    } // 添加口味标签\n\n  }, {\n    key: \"keyDownHandle\",\n    value: function keyDownHandle(val) {\n      if (event) {\n        event.cancelBubble = true;\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      if (val.target.innerText.trim() != '') {\n        this.dishFlavors[this.index].flavorData.push(val.target.innerText);\n        val.target.innerText = '';\n      }\n    } // 获取菜品分类\n\n  }, {\n    key: \"getDishList\",\n    value: function getDishList() {\n      var _this4 = this;\n\n      (0, _dish.getCategoryList)({\n        type: 1\n      }).then(function (res) {\n        if (res.data.code === 200) {\n          _this4.dishList = res && res.data && res.data.data;\n        } else {\n          _this4.$message.error(res.data.msg);\n        } // if (res.data.code == 200) {\n        //   const {data} = res.data\n        //   this.dishList = data\n        // } else {\n        //   this.$message.error(res.data.desc)\n        // }\n\n      });\n    } // 获取口味列表\n\n  }, {\n    key: \"getFlavorListHand\",\n    value: function getFlavorListHand() {\n      // flavor flavorData\n      this.dishFlavorsData = [{\n        name: '甜味',\n        value: ['无糖', '少糖', '半糖', '多糖', '全糖']\n      }, {\n        name: '温度',\n        value: ['热饮', '常温', '去冰', '少冰', '多冰']\n      }, {\n        name: '忌口',\n        value: ['不要葱', '不要蒜', '不要香菜', '不要辣']\n      }, {\n        name: '辣度',\n        value: ['不辣', '微辣', '中辣', '重辣']\n      }];\n    }\n  }, {\n    key: \"submitForm\",\n    value: function submitForm(formName, st) {\n      var _this5 = this;\n\n      ;\n      this.$refs[formName].validate(function (valid) {\n        console.log(valid, 'valid');\n\n        if (valid) {\n          if (!_this5.ruleForm.image) return _this5.$message.error('菜品图片不能为空');\n\n          var params = _objectSpread({}, _this5.ruleForm); // params.flavors = this.dishFlavors\n\n\n          params.status = _this5.actionType === 'add' ? 0 : _this5.ruleForm.status ? 1 : 0; // params.price *= 100\n\n          params.categoryId = _this5.ruleForm.categoryId;\n          params.flavors = _this5.dishFlavors.map(function (obj) {\n            return _objectSpread({}, obj, {\n              value: JSON.stringify(obj.value)\n            });\n          });\n          delete params.dishFlavors;\n\n          if (_this5.actionType == 'add') {\n            delete params.id;\n            (0, _dish.addDish)(params).then(function (res) {\n              if (res.data.code === 200) {\n                _this5.$message.success('菜品添加成功！');\n\n                if (!st) {\n                  _this5.$router.push({\n                    path: '/dish'\n                  });\n                } else {\n                  _this5.dishFlavors = []; // this.dishFlavorsData = []\n\n                  _this5.imageUrl = '';\n                  _this5.ruleForm = {\n                    name: '',\n                    id: '',\n                    price: '',\n                    code: '',\n                    image: '',\n                    description: '',\n                    dishFlavors: [],\n                    status: true,\n                    categoryId: ''\n                  };\n                  _this5.restKey++;\n                }\n              } else {\n                _this5.$message.error(res.data.desc || res.data.msg);\n              }\n            }).catch(function (err) {\n              _this5.$message.error('请求出错了：' + err.message);\n            });\n          } else {\n            delete params.createTime;\n            delete params.updateTime;\n            (0, _dish.editDish)(params).then(function (res) {\n              if (res && res.data && res.data.code === 200) {\n                _this5.$router.push({\n                  path: '/dish'\n                });\n\n                _this5.$message.success('菜品修改成功！');\n              } else {\n                _this5.$message.error(res.data.desc || res.data.msg);\n              } // if (res.data.code == 200) {\n              //   this.$router.push({'path': '/dish'})\n              //   this.$message.success('菜品修改成功！')\n              // } else {\n              //   this.$message.error(res.data.desc || res.data.message)\n              // }\n\n            }).catch(function (err) {\n              _this5.$message.error('请求出错了：' + err.message);\n            });\n          }\n        } else {\n          return false;\n        }\n      });\n    }\n  }, {\n    key: \"imageChange\",\n    value: function imageChange(value) {\n      this.ruleForm.image = value;\n    }\n  }, {\n    key: \"rules\",\n    get: function get() {\n      return {\n        name: [{\n          required: true,\n          validator: function validator(rule, value, callback) {\n            if (!value) {\n              callback(new Error('请输入菜品名称'));\n            } else {\n              var reg = /^([A-Za-z0-9\\u4e00-\\u9fa5]){2,20}$/;\n\n              if (!reg.test(value)) {\n                callback(new Error('菜品名称输入不符，请输入2-20个字符'));\n              } else {\n                callback();\n              }\n            }\n          },\n          trigger: 'blur'\n        }],\n        categoryId: [{\n          required: true,\n          message: '请选择菜品分类',\n          trigger: 'change'\n        }],\n        image: {\n          required: true,\n          message: '菜品图片不能为空'\n        },\n        price: [{\n          required: true,\n          // 'message': '请填写菜品价格',\n          validator: function validator(rules, value, callback) {\n            var reg = /^([1-9]\\d{0,5}|0)(\\.\\d{1,2})?$/;\n\n            if (!reg.test(value) || Number(value) <= 0) {\n              callback(new Error('菜品价格格式有误，请输入大于零且最多保留两位小数的金额'));\n            } else {\n              callback();\n            }\n          },\n          trigger: 'blur'\n        }],\n        code: [{\n          required: true,\n          message: '请填写商品码',\n          trigger: 'blur'\n        }]\n      };\n    }\n  }]);\n  return default_1;\n}(_vuePropertyDecorator.Vue);\n\n(0, _tslib.__decorate)([(0, _vuePropertyDecorator.Watch)('dishFlavors')], default_1.prototype, \"changeDishFlavors\", null);\ndefault_1 = (0, _tslib.__decorate)([(0, _vuePropertyDecorator.Component)({\n  name: 'addShop',\n  components: {\n    HeadLable: _index.default,\n    SelectInput: _SelectInput.default,\n    ImageUpload: _index2.default\n  }\n})], default_1);\nvar _default = default_1;\nexports.default = _default;",{"version":3,"sources":["/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huoxiyi/IdeaProjects/MissuoFrontend/src/views/dish/addDishtype.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Vue, Watch } from 'vue-property-decorator'\r\nimport HeadLable from '@/components/HeadLable/index.vue'\r\nimport SelectInput from './components/SelectInput.vue'\r\nimport ImageUpload from '@/components/ImgUpload/index.vue'\r\n// getFlavorList口味列表暂时不做 getDishTypeList\r\nimport {\r\n  queryDishById,\r\n  addDish,\r\n  editDish,\r\n  getCategoryList,\r\n  commonDownload\r\n} from '@/api/dish'\r\nimport { baseUrl } from '@/config.json'\r\nimport { getToken } from '@/utils/cookies'\r\n@Component({\r\n  name: 'addShop',\r\n  components: {\r\n    HeadLable,\r\n    SelectInput,\r\n    ImageUpload\r\n  }\r\n})\r\nexport default class extends Vue {\r\n  private restKey: number = 0\r\n  private textarea: string = ''\r\n  private value: string = ''\r\n  private imageUrl: string = ''\r\n  private actionType: string = ''\r\n  private dishList: string[] = []\r\n  private dishFlavorsData: any[] = [] //原始口味数据\r\n  private dishFlavors: any[] = [] //待上传口味的数据\r\n  private leftDishFlavors: any[] = [] //下拉框剩余可选择的口味数据\r\n  private vueRest = '1'\r\n  private index = 0\r\n  private inputStyle = { flex: 1 }\r\n  private headers = {\r\n    token: getToken()\r\n  }\r\n  private ruleForm = {\r\n    name: '',\r\n    id: '',\r\n    price: '',\r\n    code: '',\r\n    image: '',\r\n    description: '',\r\n    dishFlavors: [],\r\n    status: true,\r\n    categoryId: ''\r\n  }\r\n\r\n  get rules() {\r\n    return {\r\n      name: [\r\n        {\r\n          required: true,\r\n          validator: (rule: any, value: string, callback: Function) => {\r\n            if (!value) {\r\n              callback(new Error('请输入菜品名称'))\r\n            } else {\r\n              const reg = /^([A-Za-z0-9\\u4e00-\\u9fa5]){2,20}$/\r\n              if (!reg.test(value)) {\r\n                callback(new Error('菜品名称输入不符，请输入2-20个字符'))\r\n              } else {\r\n                callback()\r\n              }\r\n            }\r\n          },\r\n          trigger: 'blur'\r\n        }\r\n      ],\r\n      categoryId: [\r\n        { required: true, message: '请选择菜品分类', trigger: 'change' }\r\n      ],\r\n      image: {\r\n        required: true,\r\n        message: '菜品图片不能为空'\r\n      },\r\n      price: [\r\n        {\r\n          required: true,\r\n          // 'message': '请填写菜品价格',\r\n          validator: (rules: any, value: string, callback: Function) => {\r\n            const reg = /^([1-9]\\d{0,5}|0)(\\.\\d{1,2})?$/\r\n            if (!reg.test(value) || Number(value) <= 0) {\r\n              callback(\r\n                new Error(\r\n                  '菜品价格格式有误，请输入大于零且最多保留两位小数的金额'\r\n                )\r\n              )\r\n            } else {\r\n              callback()\r\n            }\r\n          },\r\n          trigger: 'blur'\r\n        }\r\n      ],\r\n      code: [{ required: true, message: '请填写商品码', trigger: 'blur' }]\r\n    }\r\n  }\r\n\r\n  created() {\r\n    this.getDishList()\r\n    // 口味临时数据\r\n    this.getFlavorListHand()\r\n    this.actionType = this.$route.query.id ? 'edit' : 'add'\r\n    if (this.$route.query.id) {\r\n      this.init()\r\n    }\r\n  }\r\n\r\n  mounted() {}\r\n  @Watch('dishFlavors')\r\n  changeDishFlavors() {\r\n    this.getLeftDishFlavors()\r\n  }\r\n\r\n  //过滤已选择的口味下拉框无法再次选择\r\n  getLeftDishFlavors() {\r\n    let arr = []\r\n    this.dishFlavorsData.map(item => {\r\n      if (\r\n        this.dishFlavors.findIndex(item1 => item.name === item1.name) === -1\r\n      ) {\r\n        arr.push(item)\r\n      }\r\n    })\r\n    this.leftDishFlavors = arr\r\n  }\r\n\r\n  private selectHandle(val: any, key: any, ind: any) {\r\n    const arrDate = [...this.dishFlavors]\r\n    const index = this.dishFlavorsData.findIndex(item => item.name === val)\r\n    arrDate[key] = JSON.parse(JSON.stringify(this.dishFlavorsData[index]))\r\n    this.dishFlavors = arrDate\r\n  }\r\n\r\n  private async init() {\r\n    queryDishById(this.$route.query.id).then(res => {\r\n      if (res && res.data && res.data.code === 200) {\r\n        this.ruleForm = { ...res.data.data }\r\n        this.ruleForm.price = String(res.data.data.price)\r\n        this.ruleForm.status = res.data.data.status == '1'\r\n        this.dishFlavors =\r\n          res.data.data.flavors &&\r\n          res.data.data.flavors.map(obj => ({\r\n            ...obj,\r\n            value: JSON.parse(obj.value)\r\n          }))\r\n        let arr = []\r\n        this.getLeftDishFlavors()\r\n        this.imageUrl = res.data.data.image\r\n      } else {\r\n        this.$message.error(res.data.msg)\r\n      }\r\n    })\r\n  }\r\n\r\n  // 按钮 - 添加口味\r\n  private addFlavore() {\r\n    this.dishFlavors.push({ name: '', value: [] }) // JSON.parse(JSON.stringify(this.dishFlavorsData))\r\n  }\r\n\r\n  // 按钮 - 删除口味\r\n  private delFlavor(name: string) {\r\n    let ind = this.dishFlavors.findIndex(item => item.name === name)\r\n    this.dishFlavors.splice(ind, 1)\r\n  }\r\n\r\n  // 按钮 - 删除口味标签\r\n  private delFlavorLabel(index: number, ind: number) {\r\n    this.dishFlavors[index].value.splice(ind, 1)\r\n  }\r\n\r\n  //口味位置记录\r\n  private flavorPosition(index: number) {\r\n    this.index = index\r\n  }\r\n\r\n  // 添加口味标签\r\n  private keyDownHandle(val: any) {\r\n    if (event) {\r\n      event.cancelBubble = true\r\n      event.preventDefault()\r\n      event.stopPropagation()\r\n    }\r\n\r\n    if (val.target.innerText.trim() != '') {\r\n      this.dishFlavors[this.index].flavorData.push(val.target.innerText)\r\n      val.target.innerText = ''\r\n    }\r\n  }\r\n\r\n  // 获取菜品分类\r\n  private getDishList() {\r\n    getCategoryList({ type: 1 }).then(res => {\r\n      if (res.data.code === 200) {\r\n        this.dishList = res && res.data && res.data.data\r\n      } else {\r\n        this.$message.error(res.data.msg)\r\n      }\r\n      // if (res.data.code == 200) {\r\n      //   const {data} = res.data\r\n      //   this.dishList = data\r\n      // } else {\r\n      //   this.$message.error(res.data.desc)\r\n      // }\r\n    })\r\n  }\r\n\r\n  // 获取口味列表\r\n  private getFlavorListHand() {\r\n    // flavor flavorData\r\n    this.dishFlavorsData = [\r\n      { name: '甜味', value: ['无糖', '少糖', '半糖', '多糖', '全糖'] },\r\n      { name: '温度', value: ['热饮', '常温', '去冰', '少冰', '多冰'] },\r\n      { name: '忌口', value: ['不要葱', '不要蒜', '不要香菜', '不要辣'] },\r\n      { name: '辣度', value: ['不辣', '微辣', '中辣', '重辣'] }\r\n    ]\r\n  }\r\n\r\n  private submitForm(formName: any, st: any) {\r\n    ;(this.$refs[formName] as any).validate((valid: any) => {\r\n      console.log(valid, 'valid')\r\n      if (valid) {\r\n        if (!this.ruleForm.image) return this.$message.error('菜品图片不能为空')\r\n        let params: any = { ...this.ruleForm }\r\n        // params.flavors = this.dishFlavors\r\n        params.status =\r\n          this.actionType === 'add' ? 0 : this.ruleForm.status ? 1 : 0\r\n        // params.price *= 100\r\n        params.categoryId = this.ruleForm.categoryId\r\n        params.flavors = this.dishFlavors.map(obj => ({\r\n          ...obj,\r\n          value: JSON.stringify(obj.value)\r\n        }))\r\n        delete params.dishFlavors\r\n        if (this.actionType == 'add') {\r\n          delete params.id\r\n          addDish(params)\r\n            .then(res => {\r\n              if (res.data.code === 200) {\r\n                this.$message.success('菜品添加成功！')\r\n                if (!st) {\r\n                  this.$router.push({ path: '/dish' })\r\n                } else {\r\n                  this.dishFlavors = []\r\n                  // this.dishFlavorsData = []\r\n                  this.imageUrl = ''\r\n                  this.ruleForm = {\r\n                    name: '',\r\n                    id: '',\r\n                    price: '',\r\n                    code: '',\r\n                    image: '',\r\n                    description: '',\r\n                    dishFlavors: [],\r\n                    status: true,\r\n                    categoryId: ''\r\n                  }\r\n                  this.restKey++\r\n                }\r\n              } else {\r\n                this.$message.error(res.data.desc || res.data.msg)\r\n              }\r\n            })\r\n            .catch(err => {\r\n              this.$message.error('请求出错了：' + err.message)\r\n            })\r\n        } else {\r\n          delete params.createTime\r\n          delete params.updateTime\r\n          editDish(params)\r\n            .then(res => {\r\n              if (res && res.data && res.data.code === 200) {\r\n                this.$router.push({ path: '/dish' })\r\n                this.$message.success('菜品修改成功！')\r\n              } else {\r\n                this.$message.error(res.data.desc || res.data.msg)\r\n              }\r\n              // if (res.data.code == 200) {\r\n              //   this.$router.push({'path': '/dish'})\r\n              //   this.$message.success('菜品修改成功！')\r\n              // } else {\r\n              //   this.$message.error(res.data.desc || res.data.message)\r\n              // }\r\n            })\r\n            .catch(err => {\r\n              this.$message.error('请求出错了：' + err.message)\r\n            })\r\n        }\r\n      } else {\r\n        return false\r\n      }\r\n    })\r\n  }\r\n\r\n  imageChange(value: any) {\r\n    this.ruleForm.image = value\r\n  }\r\n}\r\n"],"sourceRoot":""}]}